<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Drec api documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">Drec api documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >IssuerService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/pods/issuer/issuer.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#logger" >logger</a>
                            </li>
                            <li>
                                <a href="#timerForHistoyIssuanceCounter" >timerForHistoyIssuanceCounter</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#getCertificateData" >getCertificateData</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getDeviceFullReads" >getDeviceFullReads</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getDeviceFullReadsWithTimestampAndValueAsArray" >getDeviceFullReadsWithTimestampAndValueAsArray</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#handleCron" >handleCron</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#handleCronForHistoricalIssuance" >handleCronForHistoricalIssuance</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#handleCronForOngoingLateIssuance" >handleCronForOngoingLateIssuance</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#handleLeftoverReads" >handleLeftoverReads</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#handleLeftoverReadsByCountryCode" >handleLeftoverReadsByCountryCode</a>
                            </li>
                            <li>
                                <a href="#hitTheCronFromIssuerAPIHistory" >hitTheCronFromIssuerAPIHistory</a>
                            </li>
                            <li>
                                <a href="#hitTheCronFromIssuerAPIOngoing" >hitTheCronFromIssuerAPIOngoing</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#issueCertificate" >issueCertificate</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#issueCertificateForGroup" >issueCertificateForGroup</a>
                            </li>
                            <li>
                                <a href="#issueCertificateFromAPI" >issueCertificateFromAPI</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#newHistoryissueCertificateForDevice" >newHistoryissueCertificateForDevice</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#newissueCertificateForGroup" >newissueCertificateForGroup</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#roundDecimalNumber" >roundDecimalNumber</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#roundDecimalNumberByCountryCode" >roundDecimalNumberByCountryCode</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#separateIntegerAndDecimal" >separateIntegerAndDecimal</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#separateIntegerAndDecimalByCountryCode" >separateIntegerAndDecimalByCountryCode</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(groupService: <a href="../injectables/DeviceGroupService.html" target="_self">DeviceGroupService</a>, deviceService: <a href="../injectables/DeviceService.html" target="_self">DeviceService</a>, organizationService: <a href="../injectables/OrganizationService.html" target="_self">OrganizationService</a>, readservice: <a href="../injectables/ReadsService.html" target="_self">ReadsService</a>, baseReadsService: <a href="../injectables/ReadsService.html" target="_self">BaseReadsService</a>, httpService: HttpService, offChainCertificateService: <a href="../interfaces/ICertificateMetadata.html" target="_self">OffChainCertificateService&lt;ICertificateMetadata&gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="45" class="link-to-prism">src/pods/issuer/issuer.service.ts:45</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>groupService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DeviceGroupService.html" target="_self" >DeviceGroupService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>deviceService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DeviceService.html" target="_self" >DeviceService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>organizationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/OrganizationService.html" target="_self" >OrganizationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>readservice</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ReadsService.html" target="_self" >ReadsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>baseReadsService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ReadsService.html" target="_self" >BaseReadsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>httpService</td>
                                                  
                                                        <td>
                                                                    <code>HttpService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>offChainCertificateService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/ICertificateMetadata.html" target="_self" >OffChainCertificateService&lt;ICertificateMetadata&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCertificateData"></a>
                    <span class="name">
                        <span ><b>getCertificateData</b></span>
                        <a href="#getCertificateData"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getCertificateData(deviceId?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="912"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:912</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>deviceId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getDeviceFullReads"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getDeviceFullReads</b></span>
                        <a href="#getDeviceFullReads"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getDeviceFullReads(meterId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, filter: <a href="../classes/FilterDTO.html" target="_self">FilterDTO</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="873"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:873</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>meterId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>filter</td>
                                            <td>
                                                            <code><a href="../classes/FilterDTO.html" target="_self" >FilterDTO</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;number&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getDeviceFullReadsWithTimestampAndValueAsArray"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getDeviceFullReadsWithTimestampAndValueAsArray</b></span>
                        <a href="#getDeviceFullReadsWithTimestampAndValueAsArray"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getDeviceFullReadsWithTimestampAndValueAsArray(meterId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, filter: <a href="../classes/FilterDTO.html" target="_self">FilterDTO</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="863"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:863</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>meterId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>filter</td>
                                            <td>
                                                            <code><a href="../classes/FilterDTO.html" target="_self" >FilterDTO</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Array&lt;literal type&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleCron"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>handleCron</b></span>
                        <a href="#handleCron"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleCron()</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@Cron(CronExpression.EVERY_30_SECONDS)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="113"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:113</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleCronForHistoricalIssuance"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>handleCronForHistoricalIssuance</b></span>
                        <a href="#handleCronForHistoricalIssuance"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleCronForHistoricalIssuance()</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@Cron(CronExpression.EVERY_30_SECONDS)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="270"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:270</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleCronForOngoingLateIssuance"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>handleCronForOngoingLateIssuance</b></span>
                        <a href="#handleCronForOngoingLateIssuance"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleCronForOngoingLateIssuance()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="929"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:929</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleLeftoverReads"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>handleLeftoverReads</b></span>
                        <a href="#handleLeftoverReads"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleLeftoverReads(group: <a href="../entitys/DeviceGroup.html" target="_self">DeviceGroup</a>, totalReadValueW: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="822"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:822</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>group</td>
                                            <td>
                                                            <code><a href="../entitys/DeviceGroup.html" target="_self" >DeviceGroup</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>totalReadValueW</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;number&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleLeftoverReadsByCountryCode"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>handleLeftoverReadsByCountryCode</b></span>
                        <a href="#handleLeftoverReadsByCountryCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleLeftoverReadsByCountryCode(group: <a href="../entitys/DeviceGroup.html" target="_self">DeviceGroup</a>, totalReadValueW: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, countryCodeKey: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="780"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:780</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>group</td>
                                            <td>
                                                            <code><a href="../entitys/DeviceGroup.html" target="_self" >DeviceGroup</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>totalReadValueW</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>countryCodeKey</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;number&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hitTheCronFromIssuerAPIHistory"></a>
                    <span class="name">
                        <span ><b>hitTheCronFromIssuerAPIHistory</b></span>
                        <a href="#hitTheCronFromIssuerAPIHistory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>hitTheCronFromIssuerAPIHistory()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="105"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:105</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hitTheCronFromIssuerAPIOngoing"></a>
                    <span class="name">
                        <span ><b>hitTheCronFromIssuerAPIOngoing</b></span>
                        <a href="#hitTheCronFromIssuerAPIOngoing"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>hitTheCronFromIssuerAPIOngoing()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="94"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:94</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="issueCertificate"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>issueCertificate</b></span>
                        <a href="#issueCertificate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>issueCertificate(reading: <a href="../interfaces/ICertificateMetadata.html" target="_self">IIssueCommandParams&lt;ICertificateMetadata&gt;</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="904"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:904</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>reading</td>
                                            <td>
                                                            <code><a href="../interfaces/ICertificateMetadata.html" target="_self" >IIssueCommandParams&lt;ICertificateMetadata&gt;</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="issueCertificateForGroup"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>issueCertificateForGroup</b></span>
                        <a href="#issueCertificateForGroup"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>issueCertificateForGroup(group: <a href="../entitys/DeviceGroup.html" target="_self">DeviceGroup</a>, startDate: DateTime, endDate: DateTime)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="352"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:352</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>group</td>
                                            <td>
                                                            <code><a href="../entitys/DeviceGroup.html" target="_self" >DeviceGroup</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>startDate</td>
                                            <td>
                                                        <code>DateTime</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>endDate</td>
                                            <td>
                                                        <code>DateTime</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="issueCertificateFromAPI"></a>
                    <span class="name">
                        <span ><b>issueCertificateFromAPI</b></span>
                        <a href="#issueCertificateFromAPI"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>issueCertificateFromAPI(reading: <a href="../interfaces/ICertificateMetadata.html" target="_self">IIssueCommandParams&lt;ICertificateMetadata&gt;</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="897"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:897</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>reading</td>
                                            <td>
                                                            <code><a href="../interfaces/ICertificateMetadata.html" target="_self" >IIssueCommandParams&lt;ICertificateMetadata&gt;</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="newHistoryissueCertificateForDevice"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>newHistoryissueCertificateForDevice</b></span>
                        <a href="#newHistoryissueCertificateForDevice"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>newHistoryissueCertificateForDevice(group: <a href="../entitys/DeviceGroup.html" target="_self">DeviceGroup</a>, devicehistoryrequest: <a href="../entitys/HistoryIntermediate_MeterRead.html" target="_self">HistoryIntermediate_MeterRead</a>, device: <a href="../interfaces/IDevice.html" target="_self">IDevice</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="683"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:683</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>group</td>
                                            <td>
                                                            <code><a href="../entitys/DeviceGroup.html" target="_self" >DeviceGroup</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>devicehistoryrequest</td>
                                            <td>
                                                            <code><a href="../entitys/HistoryIntermediate_MeterRead.html" target="_self" >HistoryIntermediate_MeterRead</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>device</td>
                                            <td>
                                                            <code><a href="../interfaces/IDevice.html" target="_self" >IDevice</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="newissueCertificateForGroup"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>newissueCertificateForGroup</b></span>
                        <a href="#newissueCertificateForGroup"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>newissueCertificateForGroup(group: <a href="../entitys/DeviceGroup.html" target="_self">DeviceGroup</a>, grouprequest: <a href="../entitys/DeviceGroupNextIssueCertificate.html" target="_self">DeviceGroupNextIssueCertificate</a>, startDate: DateTime, endDate: DateTime, countryCodeKey: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, dateindex?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="428"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:428</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>group</td>
                                            <td>
                                                            <code><a href="../entitys/DeviceGroup.html" target="_self" >DeviceGroup</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>grouprequest</td>
                                            <td>
                                                            <code><a href="../entitys/DeviceGroupNextIssueCertificate.html" target="_self" >DeviceGroupNextIssueCertificate</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>startDate</td>
                                            <td>
                                                        <code>DateTime</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>endDate</td>
                                            <td>
                                                        <code>DateTime</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>countryCodeKey</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>dateindex</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="roundDecimalNumber"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>roundDecimalNumber</b></span>
                        <a href="#roundDecimalNumber"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>roundDecimalNumber(num: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="855"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:855</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>num</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="roundDecimalNumberByCountryCode"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>roundDecimalNumberByCountryCode</b></span>
                        <a href="#roundDecimalNumberByCountryCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>roundDecimalNumberByCountryCode(num: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="814"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:814</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>num</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="separateIntegerAndDecimal"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>separateIntegerAndDecimal</b></span>
                        <a href="#separateIntegerAndDecimal"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>separateIntegerAndDecimal(num: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="843"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:843</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>num</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>literal type</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="separateIntegerAndDecimalByCountryCode"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>separateIntegerAndDecimalByCountryCode</b></span>
                        <a href="#separateIntegerAndDecimalByCountryCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>separateIntegerAndDecimalByCountryCode(num: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="802"
                                    class="link-to-prism">src/pods/issuer/issuer.service.ts:802</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>num</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>literal type</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logger"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>logger</b></span>
                        <a href="#logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Logger(IssuerService.name)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="45" class="link-to-prism">src/pods/issuer/issuer.service.ts:45</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="timerForHistoyIssuanceCounter"></a>
                    <span class="name">
                        <span ><b>timerForHistoyIssuanceCounter</b></span>
                        <a href="#timerForHistoyIssuanceCounter"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>0</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="681" class="link-to-prism">src/pods/issuer/issuer.service.ts:681</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, NotFoundException, Logger, Inject } from &#x27;@nestjs/common&#x27;;
import { Cron, CronExpression } from &#x27;@nestjs/schedule&#x27;;
// import {
//   CertificateService,
//   CERTIFICATE_SERVICE_TOKEN,
//   IIssueCommandParams,
//   IIssuedCertificate,
//   ITransferCommand,
// } from &#x27;@energyweb/origin-247-certificate&#x27;;
import {
  IGetAllCertificatesOptions,
  IIssueCommandParams,
} from &#x27;@energyweb/origin-247-certificate&#x27;;
import { ICertificateMetadata } from &#x27;../../utils/types&#x27;;
import { DateTime } from &#x27;luxon&#x27;;
import {
  FilterDTO,
  ReadsService as BaseReadsService,
} from &#x27;@energyweb/energy-api-influxdb&#x27;;
import { v4 as uuid } from &#x27;uuid&#x27;;

import { HttpService } from &#x27;@nestjs/axios&#x27;;

import { DeviceService } from &#x27;../device/device.service&#x27;;
import { BASE_READ_SERVICE } from &#x27;../reads/const&#x27;;
import { OrganizationService } from &#x27;../organization/organization.service&#x27;;
import { DeviceGroupService } from &#x27;../device-group/device-group.service&#x27;;
import { IDevice, BuyerReservationCertificateGenerationFrequency } from &#x27;../../models&#x27;;
import { DeviceGroup } from &#x27;../device-group/device-group.entity&#x27;;
import { DeviceGroupNextIssueCertificate } from &#x27;../device-group/device_group_issuecertificate.entity&#x27;
import { AnyARecord } from &#x27;dns&#x27;;
import { EndReservationdateDTO } from &#x27;../device-group/dto&#x27;;
import { CertificateType, ReadType, SingleDeviceIssuanceStatus, StandardCompliance } from &#x27;../../utils/enums&#x27;
import { CheckCertificateIssueDateLogForDeviceEntity } from &#x27;../device/check_certificate_issue_date_log_for_device.entity&#x27;
import { CheckCertificateIssueDateLogForDeviceGroupEntity } from &#x27;../device-group/check_certificate_issue_date_log_for_device_group.entity&#x27;
import { HistoryDeviceGroupNextIssueCertificate } from &#x27;../device-group/history_next_issuance_date_log.entity&#x27;
import { ReadsService } from &#x27;../reads/reads.service&#x27;
import { HistoryIntermediate_MeterRead } from &#x27;../reads/history_intermideate_meterread.entity&#x27;;
import { Device } from &#x27;../device&#x27;;
import { OffChainCertificateService } from &#x27;@energyweb/origin-247-certificate&#x27;;
import { HistoryNextInssuanceStatus } from &#x27;../../utils/enums/history_next_issuance.enum&#x27;

@Injectable()
export class IssuerService {
  private readonly logger &#x3D; new Logger(IssuerService.name);

  constructor(
    private groupService: DeviceGroupService,
    private deviceService: DeviceService,
    private organizationService: OrganizationService,
    private readservice: ReadsService,
    // @Inject(CERTIFICATE_SERVICE_TOKEN)
    // private readonly certificateService: CertificateService&lt;ICertificateMetadata&gt;,
    @Inject(BASE_READ_SERVICE)
    private baseReadsService: BaseReadsService,
    private httpService: HttpService,
    private readonly offChainCertificateService: OffChainCertificateService&lt;ICertificateMetadata&gt;,

  ) { }

  // @Cron(CronExpression.EVERY_30_SECONDS)
  // @Cron(&#x27;0 00 21 * * *&#x27;) // Every day at 23:30 - Server Time
  // async handleCron(): Promise&lt;void&gt; {
  //   this.logger.debug(&#x27;Called every day at 23:30 Server time&#x27;);

  //   const startDate &#x3D; DateTime.now().minus({ days: 1 }).toUTC();
  //   const endDate &#x3D; DateTime.now().minus({ minute: 1 }).toUTC();

  //   this.logger.debug(&#x60;Start date ${startDate} - End date ${endDate}&#x60;);

  //   const groups &#x3D; await this.groupService.getAll();
  //   await Promise.all(
  //     groups.map(async (group: DeviceGroup) &#x3D;&gt; {


  //       group.devices &#x3D; await this.deviceService.findForGroup(group.id);
  //       const organization &#x3D; await this.organizationService.findOne(
  //         group.organizationId,
  //       );
  //       group.organization &#x3D; {
  //         name: organization.name,
  //         blockchainAccountAddress: organization.blockchainAccountAddress,
  //       };
  //       return await this.issueCertificateForGroup(group, startDate, endDate);
  //     }),
  //   );
  // }
  //@Cron(&#x27;0 00 21 * * *&#x27;)

  //@Cron(CronExpression.EVERY_30_SECONDS)
  //@Cron(&#x27;0 59 * * * *&#x27;)
  //@Cron(&#x27;0 */10 * * * *&#x27;)
  // @Cron(CronExpression.EVERY_30_SECONDS)
  hitTheCronFromIssuerAPIOngoing() {
    // //console.log(&quot;hitting issuer api&quot;);
    this.httpService.get(&#x60;${process.env.REACT_APP_BACKEND_URL}/api/drec-issuer/ongoing&#x60;).subscribe(response &#x3D;&gt; {
      // //console.log(&quot;came here&quot;,response)
    });
  }


  //@Cron(&#x27;0 59 * * * *&#x27;)
  //@Cron(&#x27;0 */10 * * * *&#x27;)
  // @Cron(CronExpression.EVERY_30_SECONDS)
  hitTheCronFromIssuerAPIHistory() {
    // //console.log(&quot;hitting issuer api&quot;);
    this.httpService.get(&#x60;${process.env.REACT_APP_BACKEND_URL}/api/drec-issuer/history&#x60;).subscribe(response &#x3D;&gt; {
      // //console.log(&quot;came here&quot;,response)
    });
  }

@Cron(CronExpression.EVERY_30_SECONDS)
  async handleCron(): Promise&lt;void&gt; {
    this.logger.debug(&#x27;Ongoing Cycle&#x27;);
    this.logger.debug(&#x27;Called every 10 minutes to check for isssuance of certificates&#x27;);

    const groupsrequestall &#x3D; await this.groupService.getAllNextrequestCertificate();
  //  console.log(groupsrequestall)
   // this.logger.debug(&quot;groupsrequestall&quot;,groupsrequestall);

    await Promise.all(
      groupsrequestall.map(async (grouprequest: DeviceGroupNextIssueCertificate) &#x3D;&gt; {
        const group &#x3D; await this.groupService.findOne(
          { id: grouprequest.groupId }
        );
       // console.log(group);
        if (!group) {
          console.error(&quot;ongoing group is missing&quot;, grouprequest.groupId);
          return;//if group is missing
        }
        if (group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; null || group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; undefined || group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; &#x27;&#x27;) {
          group.leftoverReadsByCountryCode &#x3D; {};
        }
        if (typeof group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
          group.leftoverReadsByCountryCode &#x3D; JSON.parse(group.leftoverReadsByCountryCode);
        }
        console.log(&quot;countryDevicegroup&quot;)
        var countryDevicegroup &#x3D; await this.deviceService.NewfindForGroup(group.id);
       // console.log(countryDevicegroup);
        const organization &#x3D; await this.organizationService.findOne(
          group.organizationId,
        );
        group.organization &#x3D; {
          name: organization.name,
          blockchainAccountAddress: organization.blockchainAccountAddress,
        };
        const startDate &#x3D; DateTime.fromISO(grouprequest.start_date).toUTC();
        const endDate &#x3D; DateTime.fromISO(grouprequest.end_date).toUTC();
        let start_date &#x3D; endDate.toString();

        let hours &#x3D; 1;
        const frequency &#x3D; group.frequency.toLowerCase();
        if (frequency &#x3D;&#x3D;&#x3D; BuyerReservationCertificateGenerationFrequency.daily) {
          hours &#x3D; 1 * 24;
        } else if (frequency &#x3D;&#x3D;&#x3D; BuyerReservationCertificateGenerationFrequency.monthly) {
          hours &#x3D; 30 * 24;
        } else if (frequency &#x3D;&#x3D;&#x3D; BuyerReservationCertificateGenerationFrequency.weekly) {
          hours &#x3D; 7 * 24;
        } else if (frequency &#x3D;&#x3D;&#x3D; BuyerReservationCertificateGenerationFrequency.quarterly) {
          hours &#x3D; 91 * 24;
        }
        let end_date &#x3D; new Date((new Date(new Date(endDate.toString())).getTime() + (hours * 3.6e+6))).toISOString()
        console.log(end_date);
        let newEndDate: string &#x3D; &#x27;&#x27;;
        let skipUpdatingNextIssuanceLogTable: boolean &#x3D; false;
        if (new Date(endDate.toString()).getTime() &#x3D;&#x3D;&#x3D; group.reservationEndDate.getTime()) {
          skipUpdatingNextIssuanceLogTable &#x3D; true;
          //console.log(&quot;end time reached for buyer reservation&quot;, group);
          let endDto &#x3D; new EndReservationdateDTO();
          endDto.endresavationdate &#x3D; new Date(group.reservationEndDate);
          await this.groupService.EndReservationGroup(group.id, group.organizationId, endDto, group, grouprequest);
        }
        if (!skipUpdatingNextIssuanceLogTable) {
          if (new Date(end_date).getTime() &lt; group.reservationEndDate.getTime()) {
            newEndDate &#x3D; end_date;
          }
          else {
            newEndDate &#x3D; group.reservationEndDate.toISOString();
          }
          let allDevicesOfGroup: Device[] &#x3D; await this.deviceService.findForGroup(group.id);

          try {
            //https://stackoverflow.com/a/10124053
            allDevicesOfGroup.sort(function (a, b) {
              // Turn your strings into dates, and then subtract them
              // to get a value that is either negative, positive, or zero.
              //@ts-ignore
              return new Date(b.createdAt) - new Date(a.createdAt);
            })

            let deviceOnBoardedWhichIsInBetweenNextIssuance: Device &#x3D; allDevicesOfGroup.find(ele &#x3D;&gt; {
              //returns first find which is minimum and between next frequency 
              if (new Date(ele.createdAt).getTime() &gt; new Date(start_date).getTime() &amp;&amp; new Date(ele.createdAt).getTime() &lt; new Date(newEndDate).getTime()) {
                return true;
              }
            })
            if (deviceOnBoardedWhichIsInBetweenNextIssuance) {
              newEndDate &#x3D; new Date(deviceOnBoardedWhichIsInBetweenNextIssuance.createdAt).toISOString();
            }
          }
          catch (e) {
            console.error(&quot;exception caught in inbetween device onboarding checking for createdAt&quot;);
            console.error(e);
          }
          await this.groupService.updatecertificateissuedate(grouprequest.id, start_date, newEndDate);
        }

        this.logger.debug(&#x60;Start date ${startDate} - End date ${endDate}&#x60;);

        for (let key in countryDevicegroup) {
        
          //deep clone to avoid duplicates
          let newGroup: DeviceGroup &#x3D; JSON.parse(JSON.stringify(group));
          newGroup.devices &#x3D; countryDevicegroup[key];
         await this.newissueCertificateForGroup(newGroup, grouprequest, startDate, endDate, key);
        }
     /*   if (endDate.diff(startDate, [&#x27;days&#x27;]).days &lt;&#x3D; 1) {
          for (let key in countryDevicegroup) {
            //deep clone to avoid duplicates
            let newGroup: DeviceGroup &#x3D; JSON.parse(JSON.stringify(group));
            newGroup.devices &#x3D; countryDevicegroup[key];
            // console.log(&quot;218line&quot;, startDate)
            // console.log(&quot;20619line&quot;, endDate)
            this.newissueCertificateForGroup(newGroup, grouprequest, startDate, endDate, key);
          }
          
        }
        else {
          console.log(&quot;224line,monthlytestr&quot;)
          let startDateCopy &#x3D; DateTime.fromMillis(startDate.toMillis());
          let endDateCopy &#x3D; DateTime.fromMillis(endDate.toMillis());
          const arrayofStartAndEndTimeDividedDifferenceBetweenAsOneDay: Array&lt;{ startDate: DateTime, endDate: DateTime }&gt; &#x3D; [];
          let currentDate &#x3D; startDateCopy;
          while (currentDate &lt; endDateCopy) {
            const nextDay &#x3D; currentDate.plus({ days: 1 });
            const nextEndDate &#x3D; (endDateCopy &lt; nextDay) ? endDateCopy : nextDay;
            arrayofStartAndEndTimeDividedDifferenceBetweenAsOneDay.push({
              startDate: currentDate,
              endDate: nextEndDate
            });
            currentDate &#x3D; nextDay;
          }
          for (let key in countryDevicegroup) {
            //deep clone to avoid duplicates
            let newGroup: DeviceGroup &#x3D; JSON.parse(JSON.stringify(group));
            newGroup.devices &#x3D; countryDevicegroup[key];
            arrayofStartAndEndTimeDividedDifferenceBetweenAsOneDay.forEach((ele, index) &#x3D;&gt; {
              this.newissueCertificateForGroup(JSON.parse(JSON.stringify(newGroup)), JSON.parse(JSON.stringify(grouprequest)), ele.startDate, ele.endDate, key, index);
            })
          }
        }*/
      }),
    );
  }

  // private groupBy(array: any, key: any): Promise&lt;{ [key: string]: Device[] }&gt; {
  //   //console.log(array)

  //   return array.reduce((result: any, currentValue: any) &#x3D;&gt; {

  //     (result[currentValue[key]] &#x3D; result[currentValue[key]] || []).push(
  //       currentValue
  //     );

  //     return result;
  //   }, {});
  // };

 @Cron(CronExpression.EVERY_30_SECONDS)
  async handleCronForHistoricalIssuance(): Promise&lt;void&gt; {
    const historydevicerequestall &#x3D; await this.groupService.getNextHistoryissuanceDevicelog();
    // console.log(historydevicerequestall);
    await Promise.all(
      historydevicerequestall.map(async (historydevice: HistoryDeviceGroupNextIssueCertificate, historydevicerequestindex: number) &#x3D;&gt; {
       
        const group &#x3D; await this.groupService.findOne(
          { id: historydevice.groupId }
        );
        if (!group) {
          console.error(&quot;history group is missing&quot;, historydevice.groupId);
          return;//if group is missing
        }
        const organization &#x3D; await this.organizationService.findOne(
          group.organizationId,
        );
        group.organization &#x3D; {
          name: organization.name,
          blockchainAccountAddress: organization.blockchainAccountAddress,
        };
        const device &#x3D; await this.deviceService.findReads(
          historydevice.device_externalid
        );
        const Histroryread &#x3D; await this.readservice.getCheckHistoryCertificateIssueDateLogForDevice(
          historydevice.device_externalid,
          historydevice.reservationStartDate,
          historydevice.reservationEndDate
        );
       
        if (Histroryread?.length &gt; 0) {
          await Promise.all(
            Histroryread.map(async (historydeviceread: HistoryIntermediate_MeterRead) &#x3D;&gt; {
              this.newHistoryissueCertificateForDevice(group, historydeviceread, device);
            }),
          );
          let totalhistoryreadforsingledevices &#x3D; 0;
          Histroryread.forEach((historydeviceread: HistoryIntermediate_MeterRead) &#x3D;&gt; {
            if (
              !group.buyerAddress ||
              !group.buyerId
            ) {
              return;
            }
            // minimum value of certificate should be 1 Kw &#x3D;1000W.
            if (historydeviceread.readsvalue &lt; 1000) {
              return;
            }
            totalhistoryreadforsingledevices &#x3D; totalhistoryreadforsingledevices + historydeviceread.readsvalue;
          });
          let totalReadValueMegaWattHour &#x3D; totalhistoryreadforsingledevices / 10 ** 6;

          if (totalReadValueMegaWattHour !&#x3D; 0) {
            setTimeout(() &#x3D;&gt; {
              this.groupService.updateTotalReadingRequestedForCertificateIssuance(group.id, group.organizationId, totalReadValueMegaWattHour);
            }, 1000 * (historydevicerequestindex + 1));

          }
          await this.groupService.HistoryUpdatecertificateissuedate(historydevice.id, HistoryNextInssuanceStatus.Completed);
          if (group.reservationEndDate.getTime() &lt;&#x3D; new Date(device.createdAt).getTime()) {

            await this.deviceService.removeFromGroup(device.id, group.id);
          }
         
        }
        
        await this.groupService.HistoryUpdatecertificateissuedate(historydevice.id, HistoryNextInssuanceStatus.Completed);
        if (group.reservationEndDate.getTime() &lt;&#x3D; new Date(device.createdAt).getTime()) {

          await this.deviceService.removeFromGroup(device.id, group.id);
        }
        const count &#x3D; await this.groupService.countgroupIdHistoryissuanceDevicelog(historydevice.groupId)
        console.log(&quot;count&quot;,count)
        const checknextongoingissueance &#x3D; await this.groupService.getGroupiCertificateIssueDate({ groupId: group.id })
        console.log(&quot;checknextongoingissueance&quot;, !checknextongoingissueance)
        if (count &#x3D;&#x3D;&#x3D; 0 &amp;&amp; !checknextongoingissueance) {
          await this.groupService.deactiveReaservation(group)
        }
       
      }),
    )
  }

  private async issueCertificateForGroup(
    group: DeviceGroup,
    startDate: DateTime,
    endDate: DateTime,
  ): Promise&lt;void&gt; {
    const readsFilter: FilterDTO &#x3D; {
      offset: 0,
      limit: 1000,
      start: startDate.toString(),
      end: endDate.toString(),
    };

    if (!group?.devices?.length) {
      return;
    }
    const org &#x3D; await this.organizationService.findOne(group.organizationId);
    if (!org) {
      throw new NotFoundException(
        &#x60;No organization found with code ${group.organizationId}&#x60;,
      );
    }
    const groupReads: number[] &#x3D; [];
    await Promise.all(
      group.devices.map(async (device: IDevice) &#x3D;&gt;
        groupReads.push(
          await this.getDeviceFullReads(device.externalId, readsFilter),
        ),
      ),
    );
    const totalReadValue &#x3D; groupReads.reduce(
      (accumulator, currentValue) &#x3D;&gt; accumulator + currentValue,
      0,
    );

    if (!totalReadValue) {
      return;
    }

    const totalReadValueKw &#x3D; await this.handleLeftoverReads(
      group,
      totalReadValue,
    );

    if (!totalReadValueKw) {
      return;
    }

    const issueTotalReadValue &#x3D; totalReadValueKw * 10 ** 3; // Issue certificate in watts

    const deviceGroup &#x3D; {
      ...group,
      devices: [],
    };
    const issuance: IIssueCommandParams&lt;ICertificateMetadata&gt; &#x3D; {
      deviceId: group.id?.toString(), // This is the device group id not a device id
      energyValue: issueTotalReadValue.toString(),
      fromTime: new Date(startDate.toString()),
      toTime: new Date(endDate.toString()),
      toAddress: org.blockchainAccountAddress,
      userId: org.blockchainAccountAddress,
      metadata: {
        version: &quot;v1.0&quot;,
        buyerReservationId: group.devicegroup_uid,
        deviceIds: group.devices.map((device: IDevice) &#x3D;&gt; device.id),
        //deviceGroup,
        groupId: group.id?.toString() || null,
      },
    };
    this.logger.log(
      &#x60;Issuance: ${JSON.stringify(issuance)}, Group name: ${group.name}&#x60;,
    );
    //const issuedCertificate &#x3D; await 
    this.issueCertificate(issuance);
    //await this.transferCertificateToBuyer(group, issuedCertificate);
    return;
  }
  private async newissueCertificateForGroup(
    group: DeviceGroup,
    grouprequest: DeviceGroupNextIssueCertificate,
    startDate: DateTime,
    endDate: DateTime,
    countryCodeKey: string,
    dateindex?: number
  ): Promise&lt;void&gt; {
   
    console.log(dateindex, !group?.devices?.length);
    if (!group?.devices?.length) {
      console.log(&quot;463&quot;)
      return;
    }
    const org &#x3D; await this.organizationService.findOne(group.organizationId);
    if (!org) {
      throw new NotFoundException(
        &#x60;No organization found with code ${group.organizationId}&#x60;,
      );
    }
    const groupReads: number[] &#x3D; [];
    let allDevicesCompleteReadsBetweenTimeRange: Array&lt;Array&lt;{ timestamp: Date, value: number }&gt;&gt; &#x3D; [];
    let filteredDevicesIndexesListIfMeterReadsNotAvailable: Array&lt;number&gt; &#x3D; [];
    /*Get all devices meter reads between time range */
    /*https://stackoverflow.com/questions/37576685/using-async-await-with-a-foreach-loop refer to answer why map and async works */
    await Promise.all(
      group.devices.map(async (device: IDevice, index: number) &#x3D;&gt; {

        /*
         day: 24 hours entries if hourly data  is sent , implies max entries 24 for one device
         30 days issuance : max entrries 30*24 &#x3D; 720
        quarterly: issuance : max entrries  3 months: 31*3*24 &#x3D; 2232
        so limit 5000 is kept to be on safer side
         */

        const readsFilter: FilterDTO &#x3D; {
          offset: 0,
          limit: 5000,
          start: startDate.toString(),
          end: endDate.toString(),
        };
        let allReadsForDeviceBetweenTimeRange: Array&lt;{ timestamp: Date, value: number }&gt; &#x3D; await this.getDeviceFullReadsWithTimestampAndValueAsArray(device.externalId, readsFilter);
       // console.log(&quot;475readdata&quot;, index, allReadsForDeviceBetweenTimeRange);
        if (device.meterReadtype &#x3D;&#x3D;&#x3D; &#x27;Delta&#x27;|| allReadsForDeviceBetweenTimeRange.length &gt;0) {
          const FirstDeltaRead &#x3D; await this.readservice.getDeltaMeterReadsFirstEntryOfDevice(device.externalId)
          allReadsForDeviceBetweenTimeRange &#x3D; allReadsForDeviceBetweenTimeRange.filter(v &#x3D;&gt; !(
            FirstDeltaRead.some(e &#x3D;&gt; e.readsEndDate.getTime() &#x3D;&#x3D;&#x3D; v.timestamp.getTime())))
        }
        //console.log(startDate.toString())
        //console.log(&quot;400&quot;)
        //console.log(endDate.toString())
        const certifieddevices &#x3D; await this.deviceService.getCheckCertificateIssueDateLogForDevice(device.externalId, new Date(startDate.toString()), new Date(endDate.toString()));
     //  console.log(&quot;certifieddevices&quot;);
        if (certifieddevices.length &gt; 0 &amp;&amp; allReadsForDeviceBetweenTimeRange.length &gt;0 ) {

          allReadsForDeviceBetweenTimeRange &#x3D; allReadsForDeviceBetweenTimeRange.filter(ele &#x3D;&gt; {

            let readingInBetween: boolean &#x3D; false;
            certifieddevices.forEach(certifieddevicesEle &#x3D;&gt; {
              if (ele.timestamp.getTime() &gt;&#x3D; new Date(certifieddevicesEle.certificate_issuance_startdate).getTime() &amp;&amp; ele.timestamp.getTime() &lt;&#x3D; new Date(certifieddevicesEle.certificate_issuance_enddate).getTime()) {
                readingInBetween &#x3D; true;
              }
            });
            if (readingInBetween) {
              return false;
            }
            else {
              return true;
            }
          });
        }
       // console.log(&quot;afterallReadsForDeviceBetweenTimeRange&quot;);
       
        allDevicesCompleteReadsBetweenTimeRange[index] &#x3D; allReadsForDeviceBetweenTimeRange;
        let devciereadvalue &#x3D; allReadsForDeviceBetweenTimeRange.reduce(
          (accumulator, currentValue) &#x3D;&gt; accumulator + currentValue.value,
          0,
        );
        if (devciereadvalue &#x3D;&#x3D;&#x3D; 0) {
          filteredDevicesIndexesListIfMeterReadsNotAvailable.push(index);
        }
        groupReads[index] &#x3D; devciereadvalue;
      }),
    );

    if (filteredDevicesIndexesListIfMeterReadsNotAvailable.length &gt; 0) {
      filteredDevicesIndexesListIfMeterReadsNotAvailable.forEach(index &#x3D;&gt; {
      //console.log(&quot;546&quot;,dateindex,index,group.devices);
        group.devices.splice(index, 1);
        allDevicesCompleteReadsBetweenTimeRange.splice(index, 1);
        groupReads.splice(index, 1);
      })
    }
    if (group.devices.length &#x3D;&#x3D;&#x3D; 0) {
      //after filtering if devices are not there then do not continue further 
      return;
    }
    const totalReadValue &#x3D; groupReads.reduce(
      (accumulator, currentValue) &#x3D;&gt; accumulator + currentValue,
      0,
    );
    if (!totalReadValue) {
      return;
    }
    const totalReadValueKw &#x3D; await this.handleLeftoverReadsByCountryCode(
      group,
      totalReadValue,
      countryCodeKey
    );

    if (!totalReadValueKw) {
      return;
    }
    const issueTotalReadValue &#x3D; totalReadValueKw * 10 ** 3; // Issue certificate in watts
    // const deviceGroup &#x3D; {
    //   ...group,
    //   devices: [],
    // };
    if (
      !group.buyerAddress ||
      !group.buyerId
    ) {
      return;
    }
    let allPreviousReadingsOfDevices: Array&lt;{ timestamp: Date, value: number }&gt; &#x3D; [];
    let certificateTransactionUID &#x3D; uuid();
    await Promise.all(
      group.devices.map(async (device: IDevice, index) &#x3D;&gt; {
        //console.log(&quot;came inside previous readings check&quot;);
        let previousReading: Array&lt;{ timestamp: Date, value: number }&gt; &#x3D; [];
        if (allDevicesCompleteReadsBetweenTimeRange[index].length &gt; 0) {
          let endTimestampToCheck &#x3D; new Date(allDevicesCompleteReadsBetweenTimeRange[index][0].timestamp.getTime() - 1);
          let startTimeToCheck &#x3D; device.createdAt;
          previousReading &#x3D; await this.readservice.findLastReadForMeterWithinRange(device.externalId, new Date(startTimeToCheck), endTimestampToCheck);
        // console.log(&quot;device previous reading&quot;, device.externalId, previousReading);
          //console.log(&quot;device.meterReadtype&quot;, device.meterReadtype);
          if (previousReading.length &#x3D;&#x3D; 0) {
            if (device.meterReadtype &#x3D;&#x3D;&#x3D; ReadType.Delta) {
              previousReading &#x3D; [{ timestamp: new Date(device.createdAt), value: 0 }];
            }
            else if (device.meterReadtype &#x3D;&#x3D;&#x3D; ReadType.ReadMeter) {
              try {
                let aggregateReadings &#x3D; await this.readservice.getAggregateMeterReadsFirstEntryOfDevice(device.externalId);
                if (aggregateReadings.length &gt; 0) {
                  //console.log(&quot;aggregateReadings[0].datetime&quot;, aggregateReadings[0].datetime);

                  previousReading &#x3D; [{ timestamp: new Date(aggregateReadings[0].datetime), value: 0 }];
                }
                //console.log(&quot;aggregateReadings&quot;, aggregateReadings);
              }
              catch (e) {
                console.error(&quot;error in getting aggregate read&quot;, e);
              }

            }
            //console.log(&quot;device previous reading&quot;, device.externalId, previousReading);
          }

          //change this to when was initial reading came for aggregate or else if delta then its the createdAt
          if (previousReading.length &gt; 0) {
            allPreviousReadingsOfDevices[index] &#x3D; previousReading[0];
          }
        }
        let devciereadvalue &#x3D; allDevicesCompleteReadsBetweenTimeRange[index].reduce(
          (accumulator, currentValue) &#x3D;&gt; accumulator + currentValue.value,
          0,
        );
        //console.log(&quot;previousReading&quot;, previousReading);
        //console.log(&quot;allDevicesCompleteReadsBetweenTimeRange&quot;, allDevicesCompleteReadsBetweenTimeRange);
        let devicecertificatelogDto &#x3D; new CheckCertificateIssueDateLogForDeviceEntity();
        devicecertificatelogDto.externalId &#x3D; device.externalId,
          devicecertificatelogDto.certificate_issuance_startdate &#x3D; previousReading.length &gt; 0 ? previousReading[0].timestamp : new Date(startDate.toString()),
          devicecertificatelogDto.certificate_issuance_enddate &#x3D; allDevicesCompleteReadsBetweenTimeRange[index][allDevicesCompleteReadsBetweenTimeRange[index].length - 1].timestamp,// new Date(endDate.toString()),
          devicecertificatelogDto.status &#x3D; SingleDeviceIssuanceStatus.Requested,
          devicecertificatelogDto.readvalue_watthour &#x3D; devciereadvalue;
        devicecertificatelogDto.groupId &#x3D; group.id,
          devicecertificatelogDto.certificateTransactionUID &#x3D; certificateTransactionUID.toString();
       // console.log(&quot;devicecertificatelogDto&quot;, devicecertificatelogDto);
        await this.deviceService.AddCertificateIssueDateLogForDevice(devicecertificatelogDto);
      }),
    );
    //find the minimum of all previous reading dates of devices  and use it as start date 
    let minimumStartDate: Date &#x3D; new Date(&#x27;1970-04-01T12:51:51.112Z&#x27;);
    let checkMinimumStartDate: Date &#x3D; new Date(&#x27;1970-04-01T12:51:51.112Z&#x27;);
    if (allPreviousReadingsOfDevices.length &#x3D;&#x3D; 1) {
      minimumStartDate &#x3D; allPreviousReadingsOfDevices[0].timestamp;
    }
    if (allPreviousReadingsOfDevices.length &gt; 1) {
      allPreviousReadingsOfDevices.sort(function (a, b) {
        //@ts-ignore
        return a.timestamp - b.timestamp;
      });
      minimumStartDate &#x3D; allPreviousReadingsOfDevices[0].timestamp;
    }
    let maximumEndDate: Date &#x3D; new Date(&#x27;1990-04-01T12:51:51.112Z&#x27;);
    let checkMaximumEndDate: Date &#x3D; new Date(&#x27;1990-04-01T12:51:51.112Z&#x27;);

    if (allDevicesCompleteReadsBetweenTimeRange.length &#x3D;&#x3D; 1) {
      maximumEndDate &#x3D; allDevicesCompleteReadsBetweenTimeRange[0][allDevicesCompleteReadsBetweenTimeRange[0].length - 1].timestamp;
    }
    else if (allDevicesCompleteReadsBetweenTimeRange.length &gt; 1) {
      allDevicesCompleteReadsBetweenTimeRange.forEach(ele &#x3D;&gt; {
        if (ele.length &gt; 0)//if there are readings take last index reading as its the earliest date 
        {
          if (ele[ele.length - 1].timestamp.getTime() &gt; maximumEndDate.getTime()) {
            maximumEndDate &#x3D; ele[ele.length - 1].timestamp;
          }
        }
      })
    }
   // console.log(dateindex, group.devices)
    const issuance: IIssueCommandParams&lt;ICertificateMetadata&gt; &#x3D; {
      deviceId: group.id?.toString(), // This is the device group id not a device id
      energyValue: issueTotalReadValue.toString(),
      fromTime: minimumStartDate,//new Date(startDate.toString()),
      toTime: maximumEndDate,//new Date(endDate.toString()),
      toAddress: group.buyerAddress,
      userId: group.buyerAddress,
      metadata: {
        version: &quot;v1.0&quot;,
        buyerReservationId: group.devicegroup_uid,
        isStandardIssuanceRequested: StandardCompliance.IREC,
        type: CertificateType.REC,
        deviceIds: group.devices.map((device: IDevice) &#x3D;&gt; device.id),
        //deviceGroup,
        groupId: group.id?.toString() || null,
        certificateTransactionUID: certificateTransactionUID.toString(),
      },
    };
    this.logger.log(
      &#x60;Issuance: ${JSON.stringify(issuance)}, Group name: ${group.name}&#x60;,
    );
    let totalReadValueMegaWattHour &#x3D; totalReadValueKw / 10 ** 3;
    this.groupService.updateTotalReadingRequestedForCertificateIssuance(group.id, group.organizationId, totalReadValueMegaWattHour);
    if (group.authorityToExceed &#x3D;&#x3D;&#x3D; false &amp;&amp; (group.targetVolumeCertificateGenerationRequestedInMegaWattHour + totalReadValueMegaWattHour) &gt;&#x3D; group.targetVolumeInMegaWattHour) {
      this.groupService.endReservation(group.id, group, grouprequest);
    }
    let devicegroupcertificatelogDto &#x3D; new CheckCertificateIssueDateLogForDeviceGroupEntity();
    devicegroupcertificatelogDto.groupid &#x3D; group.id?.toString(),
      devicegroupcertificatelogDto.certificate_issuance_startdate &#x3D; minimumStartDate,//new Date(startDate.toString()),
      devicegroupcertificatelogDto.certificate_issuance_enddate &#x3D; maximumEndDate,//new Date(endDate.toString()),
      devicegroupcertificatelogDto.status &#x3D; SingleDeviceIssuanceStatus.Requested,
      devicegroupcertificatelogDto.readvalue_watthour &#x3D; issueTotalReadValue,
      devicegroupcertificatelogDto.certificate_payload &#x3D; issuance,
      devicegroupcertificatelogDto.countryCode &#x3D; countryCodeKey,
      devicegroupcertificatelogDto.certificateTransactionUID &#x3D; certificateTransactionUID.toString();
    await this.groupService.AddCertificateIssueDateLogForDeviceGroup(devicegroupcertificatelogDto);
    //const issuedCertificate &#x3D; await 
    this.issueCertificate(issuance);
    ////console.log(issuedCertificate);
    //console.log(&quot;generate Succesfull&quot;);
    return;
  }
  timerForHistoyIssuanceCounter: number &#x3D; 0;

  private async newHistoryissueCertificateForDevice(
    group: DeviceGroup,
    devicehistoryrequest: HistoryIntermediate_MeterRead,
    device: IDevice
  ): Promise&lt;void&gt; {
    //console.log(&quot;HistoryIntermediate_MeterRead&quot;);
    //console.log(devicehistoryrequest);
    if (
      !group.buyerAddress ||
      !group.buyerId
    ) {
      return;
    }
    // minimum value of certificate should be 1 Kw &#x3D;1000W.
    if (devicehistoryrequest.readsvalue &lt; 1000) {
      return;
    }
    let certificateTransactionUID &#x3D; uuid();
    let devicecertificatelogDto &#x3D; new CheckCertificateIssueDateLogForDeviceEntity();
    devicecertificatelogDto.externalId &#x3D; device.externalId,
      devicecertificatelogDto.certificate_issuance_startdate &#x3D; new Date(devicehistoryrequest.readsStartDate.toString()),
      devicecertificatelogDto.certificate_issuance_enddate &#x3D; new Date(devicehistoryrequest.readsEndDate.toString()),
      devicecertificatelogDto.status &#x3D; SingleDeviceIssuanceStatus.Requested,
      devicecertificatelogDto.readvalue_watthour &#x3D; devicehistoryrequest.readsvalue;
    devicecertificatelogDto.groupId &#x3D; group.id;
    devicecertificatelogDto.certificateTransactionUID &#x3D; certificateTransactionUID.toString();
    await this.deviceService.AddCertificateIssueDateLogForDevice(devicecertificatelogDto);
    const issuance: IIssueCommandParams&lt;ICertificateMetadata&gt; &#x3D; {
      deviceId: group.id?.toString(), // This is the device group id not a device id
      energyValue: devicehistoryrequest.readsvalue.toString(),
      fromTime: new Date(devicehistoryrequest.readsStartDate.toString()),
      toTime: new Date(devicehistoryrequest.readsEndDate.toString()),
      toAddress: group.buyerAddress,
      userId: group.buyerAddress,

      metadata: {
        version: &quot;v1.0&quot;,
        buyerReservationId: group.devicegroup_uid,
        isStandardIssuanceRequested: StandardCompliance.IREC,
        type: CertificateType.REC,
        deviceIds: [device.id],
        //deviceGroup,
        certificateTransactionUID: certificateTransactionUID.toString(),
        groupId: group.id?.toString() || null,
      },
    };
    this.logger.log(
      &#x60;Issuance: ${JSON.stringify(issuance)}, Group name: ${group.name}&#x60;,
    );
    // let totalReadValueMegaWattHour &#x3D; devicehistoryrequest.readsvalue / 10 ** 6;
    // //console.log(&quot;totalReadValueMegaWattHour&quot;);
    // //console.log(totalReadValueMegaWattHour);
    // await this.groupService.updateTotalReadingRequestedForCertificateIssuance(group.id, group.organizationId, totalReadValueMegaWattHour);

    let devicegroupcertificatelogDto &#x3D; new CheckCertificateIssueDateLogForDeviceGroupEntity();
    devicegroupcertificatelogDto.groupid &#x3D; group.id?.toString(),
      devicegroupcertificatelogDto.certificate_issuance_startdate &#x3D; new Date(devicehistoryrequest.readsStartDate.toString()),//new Date(startDate.toString()),
      devicegroupcertificatelogDto.certificate_issuance_enddate &#x3D; new Date(devicehistoryrequest.readsEndDate.toString()),//new Date(endDate.toString()),
      devicegroupcertificatelogDto.status &#x3D; SingleDeviceIssuanceStatus.Requested,
      devicegroupcertificatelogDto.readvalue_watthour &#x3D; devicehistoryrequest.readsvalue,
      devicegroupcertificatelogDto.certificate_payload &#x3D; issuance,
      devicegroupcertificatelogDto.countryCode &#x3D; device.countryCode,
      devicegroupcertificatelogDto.certificateTransactionUID &#x3D; certificateTransactionUID.toString();
    await this.groupService.AddCertificateIssueDateLogForDeviceGroup(devicegroupcertificatelogDto);
    //const issuedCertificate &#x3D; await 
    this.issueCertificate(issuance);

    //console.log(&quot;generate Succesfull&quot;);
    await this.readservice.updatehistorycertificateissuedate(devicehistoryrequest.id, devicehistoryrequest.readsStartDate, devicehistoryrequest.readsEndDate);
    return;
  }
  /*
    private async transferCertificateToBuyer(
      group: DeviceGroup,
      certificate: IIssuedCertificate&lt;ICertificateMetadata&gt;,
    ) {
      if (
        !certificate ||
        !group.buyerAddress ||
        !group.buyerId ||
        !group.organization?.blockchainAccountAddress
      ) {
        return;
      }
      this.logger.log(&#x60;Transfering a certificate&#x60;);
      const transferCommand: ITransferCommand &#x3D; {
        certificateId: certificate.id,
        fromAddress: group.organization.blockchainAccountAddress,
        toAddress: group.buyerAddress,
        energyValue: certificate.energy.publicVolume,
      };
      await this.certificateService.transfer(transferCommand);
    }
  
    */


  private async handleLeftoverReadsByCountryCode(
    group: DeviceGroup,
    totalReadValueW: number,
    countryCodeKey: string
  ): Promise&lt;number&gt; {
    // Logic
    // 1. Get the accummulated read values from devices
    // 2. Transform current value from watts to kw
    // 3. Add any leftover value from group to the current total value
    // 4. Separate all decimal values from the curent kw value and store it as leftover value to the device group
    // 5. Return all the integer value from the current kw value (if any) and continue issuing the certificate

    const totalReadValueKw &#x3D; group.leftoverReadsByCountryCode[countryCodeKey]
      ? totalReadValueW / 10 ** 3 + group.leftoverReadsByCountryCode[countryCodeKey]
      : totalReadValueW / 10 ** 3;
    const { integralVal, decimalVal } &#x3D;
      this.separateIntegerAndDecimalByCountryCode(totalReadValueKw);
    await this.groupService.updateLeftOverReadByCountryCode(group.id, decimalVal, countryCodeKey);

    return integralVal;
  }

  private separateIntegerAndDecimalByCountryCode(num: number): {
    integralVal: number;
    decimalVal: number;
  } {
    if (!num) {
      return { integralVal: 0, decimalVal: 0 };
    }
    const integralVal &#x3D; Math.floor(num);
    const decimalVal &#x3D; this.roundDecimalNumberByCountryCode(num - integralVal);
    return { integralVal, decimalVal };
  }

  private roundDecimalNumberByCountryCode(num: number): number {
    if (num &#x3D;&#x3D;&#x3D; 0) {
      return num;
    }
    const precision &#x3D; 2;
    return Math.round(num * 10 ** precision) / 10 ** precision;
  }

  private async handleLeftoverReads(
    group: DeviceGroup,
    totalReadValueW: number,
  ): Promise&lt;number&gt; {
    // Logic
    // 1. Get the accummulated read values from devices
    // 2. Transform current value from watts to kw
    // 3. Add any leftover value from group to the current total value
    // 4. Separate all decimal values from the curent kw value and store it as leftover value to the device group
    // 5. Return all the integer value from the current kw value (if any) and continue issuing the certificate

    const totalReadValueKw &#x3D; group.leftoverReads
      ? totalReadValueW / 10 ** 3 + group.leftoverReads
      : totalReadValueW / 10 ** 3;
    const { integralVal, decimalVal } &#x3D;
      this.separateIntegerAndDecimal(totalReadValueKw);
    await this.groupService.updateLeftOverRead(group.id, decimalVal);

    return integralVal;
  }

  private separateIntegerAndDecimal(num: number): {
    integralVal: number;
    decimalVal: number;
  } {
    if (!num) {
      return { integralVal: 0, decimalVal: 0 };
    }
    const integralVal &#x3D; Math.floor(num);
    const decimalVal &#x3D; this.roundDecimalNumber(num - integralVal);
    return { integralVal, decimalVal };
  }

  private roundDecimalNumber(num: number): number {
    if (num &#x3D;&#x3D;&#x3D; 0) {
      return num;
    }
    const precision &#x3D; 2;
    return Math.round(num * 10 ** precision) / 10 ** precision;
  }

  private async getDeviceFullReadsWithTimestampAndValueAsArray(
    meterId: string,
    filter: FilterDTO,
  ): Promise&lt;Array&lt;{ timestamp: Date, value: number }&gt;&gt; {
    //console.log(&quot;381&quot;)
    const allReads: Array&lt;{ timestamp: Date, value: number }&gt; &#x3D; await this.baseReadsService.find(meterId, filter);
    //console.log(&#x60;allReads externalId:${meterId}&#x60;, allReads);
    return allReads;
  }

  private async getDeviceFullReads(
    meterId: string,
    filter: FilterDTO,
  ): Promise&lt;number&gt; {
    //console.log(&quot;381&quot;)
    const allReads &#x3D; await this.baseReadsService.find(meterId, filter);
    //console.log(&#x60;allReads externalId:${meterId}&#x60;, allReads);
    return allReads.reduce(
      (accumulator, currentValue) &#x3D;&gt; accumulator + currentValue.value,
      0,
    );
  }

  // private async issueCertificate(
  //   reading: IIssueCommandParams&lt;ICertificateMetadata&gt;,
  // ): Promise&lt;IIssuedCertificate&lt;ICertificateMetadata&gt;&gt; {
  //   this.logger.log(&#x60;Issuing a certificate for reading&#x60;);
  //   const issuedCertificate &#x3D; await this.certificateService.issue(reading);
  //   this.logger.log(&#x60;Issued a certificate with ID ${issuedCertificate.id}&#x60;);
  //   return issuedCertificate;
  // }

  //actual definition is up removing async

  issueCertificateFromAPI(reading: IIssueCommandParams&lt;ICertificateMetadata&gt;) {
    reading.fromTime &#x3D; new Date(reading.fromTime);
    reading.toTime &#x3D; new Date(reading.toTime);
    this.issueCertificate(reading);

  }

  private issueCertificate(
    reading: IIssueCommandParams&lt;ICertificateMetadata&gt;,
  ) {
    this.logger.log(&#x60;Issuing a certificate for reading&#x60;);
    this.offChainCertificateService.issue(reading);
  }


  getCertificateData(deviceId?: string) {
    let request: IGetAllCertificatesOptions &#x3D; {
      // generationEndFrom: new Date(1677671426*1000),
      // generationEndTo: new Date(1677671426*1000),
      //  generationStartFrom :new Date(1646622684*1000),
      // generationStartTo: new Date(1648159894*1000),
      // creationTimeFrom: Date;
      //  creationTimeTo: Date;
      deviceId: &quot;51&quot;
    }

    this.offChainCertificateService.getAll(request).then(result &#x3D;&gt; {
      console.log(&quot;certificates&quot;, result);
    });
  }

 // @Cron(&#x27;0 */4 * * *&#x27;)
  async handleCronForOngoingLateIssuance(): Promise&lt;void&gt; {
    this.logger.debug(&#x27;late ongoing issuance&#x27;);
    this.logger.debug(&#x27;Called every 4hr to check for isssuance of certificates&#x27;);
    const devicegroups &#x3D; await this.groupService.getallReservationactive();
    //this.logger.debug(&quot;groupsrequestall&quot;,groupsrequestall);
    await Promise.all(

      devicegroups.map(async (grouprequest: DeviceGroup) &#x3D;&gt; {
        const group &#x3D; grouprequest;
        if (!group) {
          console.error(&quot;late ongoing group is missing&quot;, grouprequest.id);
          return;//if group is missing
        }
        if (group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; null || group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; undefined || group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; &#x27;&#x27;) {
          group.leftoverReadsByCountryCode &#x3D; {};
        }
        if (typeof group.leftoverReadsByCountryCode &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
          group.leftoverReadsByCountryCode &#x3D; JSON.parse(group.leftoverReadsByCountryCode);
        }
        var countryDevicegroup &#x3D; await this.deviceService.NewfindForGroup(group.id);
        const organization &#x3D; await this.organizationService.findOne(
          group.organizationId,
        );
        group.organization &#x3D; {
          name: organization.name,
          blockchainAccountAddress: organization.blockchainAccountAddress,
        };
        const nextissuance &#x3D; await this.groupService.getGroupiCertificateIssueDate({ groupId: group.id })
        console.log(nextissuance);
        for (let key in countryDevicegroup) {
          //deep clone to avoid duplicates
          let newGroup: DeviceGroup &#x3D; JSON.parse(JSON.stringify(group));

          newGroup.devices &#x3D; countryDevicegroup[key];
          await Promise.all(
            newGroup.devices.map(async (element) &#x3D;&gt; {
          
              const lastread &#x3D; await this.readservice.latestread(element.externalId, (new Date(element.createdAt)).toISOString())
             
              const lastcertifieddeviceend_date &#x3D; await this.deviceService.getLastCertifiedDevicelogBYgroupId(group.id, element.externalId)
              let newGroupwithsingledevice: DeviceGroup &#x3D; JSON.parse(JSON.stringify(newGroup));
              newGroupwithsingledevice.devices &#x3D; [element];
              let startDate;
              let endDate;
              // 
              if (lastcertifieddeviceend_date &#x3D;&#x3D;&#x3D; undefined) {

                if ((element.createdAt).getTime() &lt;&#x3D; (group.reservationStartDate).getTime()) {
                  startDate &#x3D; DateTime.fromISO(group.reservationStartDate.toISOString()).toUTC();
                }
                else {
                  startDate &#x3D; DateTime.fromISO(new Date(element.createdAt).toISOString()).toUTC();
                }
              }
              else {
                startDate &#x3D; DateTime.fromISO(lastcertifieddeviceend_date.certificate_issuance_enddate.toISOString()).toUTC();
              }
              if (new Date(lastread[0].timestamp).getTime() &lt; new Date(nextissuance.start_date).getTime()) {
                endDate &#x3D; DateTime.fromISO(new Date(lastread[0].timestamp).toISOString()).toUTC();
              }

              if (new Date(lastread[0].timestamp).getTime() &gt; new Date(nextissuance.start_date).getTime()) {
                endDate &#x3D; DateTime.fromISO(new Date(nextissuance.start_date).toISOString()).toUTC();
              }
              this.newissueCertificateForGroup(newGroupwithsingledevice, nextissuance, startDate, endDate, key);
            })
          )
        }

      }),
    );
  }


  // @Cron(CronExpression.EVERY_30_SECONDS)
  // async testtime(): Promise&lt;void&gt; {

  //   const leates &#x3D; await this.readservice.latestread(&#x27;f1a8befb-5dca-4c12-a71b-793f492803d4&#x27;, &#x27;2022-04-20T07:45:45.405Z&#x27;);
  //   console.log(leates[0].timestamp.getTime());

  //   const lastcertifieddeviceend_date &#x3D; await this.deviceService.getLastCertifiedDevicelogBYgroupId(2, &#x27;f1a8befb-5dca-4c12-a71b-793f492803d4&#x27;);
  //   console.log(lastcertifieddeviceend_date.certificate_issuance_enddate.getTime())

  // }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'IssuerService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
